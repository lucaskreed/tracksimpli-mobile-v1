<script type="module">
  import { supabase } from "../js/supabase.js";

  // 1. Check session
  const { data: sessionData } = await supabase.auth.getSession();

  if (!sessionData.session) {
    window.location.href = "../auth/login.html";
  }

  const user = sessionData.session.user;

  // 2. Ensure profile exists
  await supabase.from("profiles").upsert({
    id: user.id,
    email: user.email
  });

  // 3. Show something so you know it worked
  document.body.insertAdjacentHTML(
    "beforeend",
    `<p>Logged in as ${user.email}</p>`
  );
</script>
